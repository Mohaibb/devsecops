events {}

http {
    upstream app_backend {
        server app1:5000;
    }

    upstream api_backend {
        server app2:5000;
    }

    # HTTP server (port 80)
    server {
        listen 80;

        location /app {
            proxy_pass http://app_backend;
        }

        location /api {
            proxy_pass http://api_backend;
        }

        location / {
            return 302 /app;
        }
    }

    # HTTPS server (port 443) with TLS termination
    server {
        listen 443 ssl;

        ssl_certificate     /etc/nginx/certs/selfsigned.crt;
        ssl_certificate_key /etc/nginx/certs/selfsigned.key;

        location /app {
            proxy_pass http://app_backend;
        }

        location /api {
            proxy_pass http://api_backend;
        }

        location / {
            return 302 /app;
        }
    }
}